<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cooker Recipe Solver</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for a cleaner look */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
        }
        .card {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .tab-button {
            padding: 10px 15px;
            border-bottom: 2px solid transparent;
            font-weight: 600;
            transition: all 0.2s;
            color: #6366f1; /* Indigo-500 */
        }
        .tab-button.active {
            border-bottom: 3px solid #4f46e5; /* Indigo-600 */
            color: #1e3a8a; /* Darker text for active tab */
        }
        .tab-button:hover:not(.active) {
            border-bottom-color: #a5b4fc; /* Indigo-300 */
        }
        /* Style for the results list */
        #possible-recipes {
            max-height: 250px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            padding: 1rem;
        }
        .range-box {
            padding: 1rem;
            border-radius: 0.5rem;
            background-color: #eef2ff; /* Indigo-50 */
            text-align: center;
        }
        .scrollable-inputs {
            max-height: 350px;
            overflow-y: auto;
            padding-right: 8px; /* For scrollbar spacing */
        }
    </style>
</head>
<body class="p-4 flex items-center justify-center min-h-screen">

<div id="app" class="w-full max-w-lg bg-white p-8 rounded-xl card border-t-4 border-indigo-600">
    <h1 class="text-3xl font-extrabold text-gray-900 mb-2 text-center">
        Cooker Recipe Solver
    </h1>
    <p class="text-center text-gray-500 mb-8">
        Find the secret 3-digit recipe.
    </p>

    <!-- Tab Navigation -->
    <div class="flex border-b border-gray-200 mb-6 -mx-1 overflow-x-auto justify-between">
        <button class="tab-button flex-shrink-0" data-tab="four-step" onclick="showTab('four-step')">4 Step Method</button>
        <button class="tab-button flex-shrink-0" data-tab="single-cook" onclick="showTab('single-cook')">Range Finder</button>
        <button class="tab-button active flex-shrink-0" data-tab="two-cook" onclick="showTab('two-cook')">Unlimited Method</button>
    </div>

    <!-- 4 Step Method Tab Content -->
    <div id="four-step" class="tab-content hidden">
        <p class="text-sm text-gray-500 mb-4">
            **Classic Method (Requires 3% consistency).** Enter test cooks 0-0-0, 10-0-0, 0-10-0, and 0-0-10.
        </p>
        <div class="space-y-4">

            <!-- Cook 1: 0-0-0 -->
            <div class="flex items-center justify-between p-3 bg-indigo-50 rounded-lg">
                <label for="p1" class="font-medium text-indigo-800">Cook 1 (0-0-0):</label>
                <div class="flex items-center space-x-2">
                    <input type="number" id="p1" min="0" max="100" value="54"
                           class="w-20 p-2 border border-indigo-300 rounded-lg text-center font-mono focus:ring-2 focus:ring-indigo-500" required>
                    <span class="text-indigo-800 font-bold">%</span>
                </div>
            </div>

            <!-- Cook 2: 10-0-0 -->
            <div class="flex items-center justify-between p-3 bg-indigo-50 rounded-lg">
                <label for="p2" class="font-medium text-indigo-800">Cook 2 (10-0-0):</label>
                <div class="flex items-center space-x-2">
                    <input type="number" id="p2" min="0" max="100" value="64"
                           class="w-20 p-2 border border-indigo-300 rounded-lg text-center font-mono focus:ring-2 focus:ring-indigo-500" required>
                    <span class="text-indigo-800 font-bold">%</span>
                </div>
            </div>

            <!-- Cook 3: 0-10-0 -->
            <div class="flex items-center justify-between p-3 bg-indigo-50 rounded-lg">
                <label for="p3" class="font-medium text-indigo-800">Cook 3 (0-10-0):</label>
                <div class="flex items-center space-x-2">
                    <input type="number" id="p3" min="0" max="100" value="48"
                           class="w-20 p-2 border border-indigo-300 rounded-lg text-center font-mono focus:ring-2 focus:ring-indigo-500" required>
                    <span class="text-indigo-800 font-bold">%</span>
                </div>
            </div>

            <!-- Cook 4: 0-0-10 -->
            <div class="flex items-center justify-between p-3 bg-indigo-50 rounded-lg">
                <label for="p4" class="font-medium text-indigo-800">Cook 4 (0-0-10):</label>
                <div class="flex items-center space-x-2">
                    <input type="number" id="p4" min="0" max="100" value="67"
                           class="w-20 p-2 border border-indigo-300 rounded-lg text-center font-mono focus:ring-2 focus:ring-indigo-500" required>
                    <span class="text-indigo-800 font-bold">%</span>
                </div>
            </div>
        </div>

        <button onclick="solveRecipe('four-step')"
                class="mt-6 w-full py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition duration-150 transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50">
            SOLVE FULL RECIPE (Linear Algebra)
        </button>
    </div>

    <!-- Single Cook Analysis Tab Content -->
    <div id="single-cook" class="tab-content hidden">
        <p class="text-sm text-gray-500 mb-4">
            **Range Finder (Requires 3% consistency).** Enter one test cook's data to find the possible R1/R2/R3 ranges.
        </p>
        
        <div class="space-y-4">
            <h3 class="font-semibold text-indigo-700 mt-2">Single Test Cook Data (R1-R2-R3 = %)</h3>
            <div class="flex space-x-2 items-center">
                <input type="number" id="a1" min="0" max="10" value="0" placeholder="R1" 
                       class="w-1/5 p-2 border rounded-lg text-center focus:ring-2 focus:ring-indigo-500">
                <input type="number" id="a2" min="0" max="10" value="0" placeholder="R2" 
                       class="w-1/5 p-2 border rounded-lg text-center focus:ring-2 focus:ring-indigo-500">
                <input type="number" id="a3" min="0" max="10" value="0" placeholder="R3" 
                       class="w-1/5 p-2 border rounded-lg text-center focus:ring-2 focus:ring-indigo-500">
                <span class="text-2xl font-light">=</span>
                <input type="number" id="pa" min="10" max="100" value="0" placeholder="%" 
                       class="w-1/5 p-2 border rounded-lg text-center font-mono focus:ring-2 focus:ring-indigo-500">
                <span class="text-indigo-800 font-bold self-center">%</span>
            </div>
        </div>

        <button onclick="solveRecipe('single-cook')"
                class="mt-6 w-full py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition duration-150 transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50">
            ANALYZE RANGES
        </button>
    </div>
    
    <!-- Unlimited Method (Brute Force) Tab Content -->
    <div id="two-cook" class="tab-content">
        <p class="text-sm text-red-700 font-bold mb-2">
            **Unlimited Method (Anomaly Resistant).** Enter 2-10 of your test cooks to find the **closest** matching $100\%$ recipe via Brute Force.
        </p>
        <p class="text-sm text-gray-500 mb-4">
            This method minimizes the total error across all cooks to find the true Secret Recipe.
        </p>
        
        <div id="cook-inputs" class="space-y-3 scrollable-inputs">
             <!-- Cook 1: 0-0-0 (Fixed Input) -->
             <h3 class="font-semibold text-indigo-700 mt-2">Test Cook 1 (0-0-0)</h3>
            <div class="flex space-x-2 items-center">
                <input type="number" id="bf_a1" min="0" max="10" value="0" placeholder="R1" readonly
                       class="w-1/5 p-2 border rounded-lg text-center bg-gray-200">
                <input type="number" id="bf_a2" min="0" max="10" value="0" placeholder="R2" readonly
                       class="w-1/5 p-2 border rounded-lg text-center bg-gray-200">
                <input type="number" id="bf_a3" min="0" max="10" value="0" placeholder="R3" readonly
                       class="w-1/5 p-2 border rounded-lg text-center bg-gray-200">
                <span class="text-2xl font-light">=</span>
                <input type="number" id="bf_pa" min="10" max="100" value="54" placeholder="%" 
                       class="w-1/5 p-2 border rounded-lg text-center font-mono focus:ring-2 focus:ring-indigo-500">
                <span class="text-indigo-800 font-bold self-center">%</span>
            </div>
            
            <!-- Cook 2: 10-0-0 (Fixed Input) -->
            <h3 class="font-semibold text-indigo-700 mb-2">Test Cook 2 (10-0-0)</h3>
            <div class="flex space-x-2 items-center">
                <input type="number" id="bf_b1" min="0" max="10" value="10" placeholder="R1" readonly
                       class="w-1/5 p-2 border rounded-lg text-center bg-gray-200">
                <input type="number" id="bf_b2" min="0" max="10" value="0" placeholder="R2" readonly
                       class="w-1/5 p-2 border rounded-lg text-center bg-gray-200">
                <input type="number" id="bf_b3" min="0" max="10" value="0" placeholder="R3" readonly
                       class="w-1/5 p-2 border rounded-lg text-center bg-gray-200">
                <span class="text-2xl font-light">=</span>
                <input type="number" id="bf_pb" min="10" max="100" value="64" placeholder="%" 
                       class="w-1/5 p-2 border rounded-lg text-center font-mono focus:ring-2 focus:ring-indigo-500">
                <span class="text-indigo-800 font-bold self-center">%</span>
            </div>

            <!-- Cook 3: 0-10-0 (Fixed Input) -->
            <h3 class="font-semibold text-indigo-700 mb-2">Test Cook 3 (0-10-0)</h3>
            <div class="flex space-x-2 items-center">
                <input type="number" id="bf_c1" min="0" max="10" value="0" placeholder="R1" readonly
                       class="w-1/5 p-2 border rounded-lg text-center bg-gray-200">
                <input type="number" id="bf_c2" min="0" max="10" value="10" placeholder="R2" readonly
                       class="w-1/5 p-2 border rounded-lg text-center bg-gray-200">
                <input type="number" id="bf_c3" min="0" max="10" value="0" placeholder="R3" readonly
                       class="w-1/5 p-2 border rounded-lg text-center bg-gray-200">
                <span class="text-2xl font-light">=</span>
                <input type="number" id="bf_pc" min="10" max="100" value="48" placeholder="%" 
                       class="w-1/5 p-2 border rounded-lg text-center font-mono focus:ring-2 focus:ring-indigo-500">
                <span class="text-indigo-800 font-bold self-center">%</span>
            </div>

             <!-- Cook 4: 0-0-10 (Fixed Input) -->
             <h3 class="font-semibold text-indigo-700 mb-2">Test Cook 4 (0-0-10)</h3>
            <div class="flex space-x-2 items-center">
                <input type="number" id="bf_d1" min="0" max="10" value="0" placeholder="R1" readonly
                       class="w-1/5 p-2 border rounded-lg text-center bg-gray-200">
                <input type="number" id="bf_d2" min="0" max="10" value="0" placeholder="R2" readonly
                       class="w-1/5 p-2 border rounded-lg text-center bg-gray-200">
                <input type="number" id="bf_d3" min="0" max="10" value="10" placeholder="R3" readonly
                       class="w-1/5 p-2 border rounded-lg text-center bg-gray-200">
                <span class="text-2xl font-light">=</span>
                <input type="number" id="bf_pd" min="10" max="100" value="67" placeholder="%" 
                       class="w-1/5 p-2 border rounded-lg text-center font-mono focus:ring-2 focus:ring-indigo-500">
                <span class="text-indigo-800 font-bold self-center">%</span>
            </div>
            
            <!-- Cook 5: Optional -->
            <h3 class="font-semibold text-indigo-700 mb-2">Test Cook 5 (Optional)</h3>
            <div class="flex space-x-2 items-center">
                <input type="number" id="bf_e1" min="0" max="10" value="" placeholder="R1" 
                       class="w-1/5 p-2 border rounded-lg text-center focus:ring-2 focus:ring-indigo-500">
                <input type="number" id="bf_e2" min="0" max="10" value="" placeholder="R2" 
                       class="w-1/5 p-2 border rounded-lg text-center focus:ring-2 focus:ring-indigo-500">
                <input type="number" id="bf_e3" min="0" max="10" value="" placeholder="R3" 
                       class="w-1/5 p-2 border rounded-lg text-center focus:ring-2 focus:ring-indigo-500">
                <span class="text-2xl font-light">=</span>
                <input type="number" id="bf_pe" min="10" max="100" value="" placeholder="%" 
                       class="w-1/5 p-2 border rounded-lg text-center font-mono focus:ring-2 focus:ring-indigo-500">
                <span class="text-indigo-800 font-bold self-center">%</span>
            </div>

            <!-- Cook 6: Optional -->
            <h3 class="font-semibold text-indigo-700 mb-2">Test Cook 6 (Optional)</h3>
            <div class="flex space-x-2 items-center">
                <input type="number" id="bf_f1" min="0" max="10" value="" placeholder="R1" 
                       class="w-1/5 p-2 border rounded-lg text-center focus:ring-2 focus:ring-indigo-500">
                <input type="number" id="bf_f2" min="0" max="10" value="" placeholder="R2" 
                       class="w-1/5 p-2 border rounded-lg text-center focus:ring-2 focus:ring-indigo-500">
                <input type="number" id="bf_f3" min="0" max="10" value="" placeholder="R3" 
                       class="w-1/5 p-2 border rounded-lg text-center focus:ring-2 focus:ring-indigo-500">
                <span class="text-2xl font-light">=</span>
                <input type="number" id="bf_pf" min="10" max="100" value="" placeholder="%" 
                       class="w-1/5 p-2 border rounded-lg text-center font-mono focus:ring-2 focus:ring-indigo-500">
                <span class="text-indigo-800 font-bold self-center">%</span>
            </div>
            
            <!-- Cook 7: Optional -->
            <h3 class="font-semibold text-indigo-700 mb-2">Test Cook 7 (Optional)</h3>
            <div class="flex space-x-2 items-center">
                <input type="number" id="bf_g1" min="0" max="10" value="" placeholder="R1" 
                       class="w-1/5 p-2 border rounded-lg text-center focus:ring-2 focus:ring-indigo-500">
                <input type="number" id="bf_g2" min="0" max="10" value="" placeholder="R2" 
                       class="w-1/5 p-2 border rounded-lg text-center focus:ring-2 focus:ring-indigo-500">
                <input type="number" id="bf_g3" min="0" max="10" value="" placeholder="R3" 
                       class="w-1/5 p-2 border rounded-lg text-center focus:ring-2 focus:ring-indigo-500">
                <span class="text-2xl font-light">=</span>
                <input type="number" id="bf_pg" min="10" max="100" value="" placeholder="%" 
                       class="w-1/5 p-2 border rounded-lg text-center font-mono focus:ring-2 focus:ring-indigo-500">
                <span class="text-indigo-800 font-bold self-center">%</span>
            </div>

            <!-- Cook 8: Optional -->
            <h3 class="font-semibold text-indigo-700 mb-2">Test Cook 8 (Optional)</h3>
            <div class="flex space-x-2 items-center">
                <input type="number" id="bf_h1" min="0" max="10" value="" placeholder="R1" 
                       class="w-1/5 p-2 border rounded-lg text-center focus:ring-2 focus:ring-indigo-500">
                <input type="number" id="bf_h2" min="0" max="10" value="" placeholder="R2" 
                       class="w-1/5 p-2 border rounded-lg text-center focus:ring-2 focus:ring-indigo-500">
                <input type="number" id="bf_h3" min="0" max="10" value="" placeholder="R3" 
                       class="w-1/5 p-2 border rounded-lg text-center focus:ring-2 focus:ring-indigo-500">
                <span class="text-2xl font-light">=</span>
                <input type="number" id="bf_ph" min="10" max="100" value="" placeholder="%" 
                       class="w-1/5 p-2 border rounded-lg text-center font-mono focus:ring-2 focus:ring-indigo-500">
                <span class="text-indigo-800 font-bold self-center">%</span>
            </div>

            <!-- Cook 9: Optional -->
            <h3 class="font-semibold text-indigo-700 mb-2">Test Cook 9 (Optional)</h3>
            <div class="flex space-x-2 items-center">
                <input type="number" id="bf_i1" min="0" max="10" value="" placeholder="R1" 
                       class="w-1/5 p-2 border rounded-lg text-center focus:ring-2 focus:ring-indigo-500">
                <input type="number" id="bf_i2" min="0" max="10" value="" placeholder="R2" 
                       class="w-1/5 p-2 border rounded-lg text-center focus:ring-2 focus:ring-indigo-500">
                <input type="number" id="bf_i3" min="0" max="10" value="" placeholder="R3" 
                       class="w-1/5 p-2 border rounded-lg text-center focus:ring-2 focus:ring-indigo-500">
                <span class="text-2xl font-light">=</span>
                <input type="number" id="bf_pi" min="10" max="100" value="" placeholder="%" 
                       class="w-1/5 p-2 border rounded-lg text-center font-mono focus:ring-2 focus:ring-indigo-500">
                <span class="text-indigo-800 font-bold self-center">%</span>
            </div>

            <!-- Cook 10: Optional -->
            <h3 class="font-semibold text-indigo-700 mb-2">Test Cook 10 (Optional)</h3>
            <div class="flex space-x-2 items-center">
                <input type="number" id="bf_j1" min="0" max="10" value="" placeholder="R1" 
                       class="w-1/5 p-2 border rounded-lg text-center focus:ring-2 focus:ring-indigo-500">
                <input type="number" id="bf_j2" min="0" max="10" value="" placeholder="R2" 
                       class="w-1/5 p-2 border rounded-lg text-center focus:ring-2 focus:ring-indigo-500">
                <input type="number" id="bf_j3" min="0" max="10" value="" placeholder="R3" 
                       class="w-1/5 p-2 border rounded-lg text-center focus:ring-2 focus:ring-indigo-500">
                <span class="text-2xl font-light">=</span>
                <input type="number" id="bf_pj" min="10" max="100" value="" placeholder="%" 
                       class="w-1/5 p-2 border rounded-lg text-center font-mono focus:ring-2 focus:ring-indigo-500">
                <span class="text-indigo-800 font-bold self-center">%</span>
            </div>
        </div>

        <button onclick="solveRecipe('brute-force')"
                class="mt-6 w-full py-3 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition duration-150 transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-red-500 focus:ring-opacity-50">
            FIND BEST FIT RECIPE (Minimize Total Error)
        </button>
    </div>


    <!-- Results/Message Area -->
    <div id="results-container" class="mt-8 pt-6 border-t border-gray-200">
        <div id="message" class="text-center font-medium min-h-10">
            <!-- Messages and results appear here -->
        </div>
        
        <div id="recipe-display" class="hidden flex flex-col items-center justify-center p-6 bg-green-50 border border-green-200 rounded-xl">
            <p class="text-lg font-semibold text-green-800 mb-3">
                <span id="recipe-display-title"></span>
            </p>
            <!-- This shows the single result for the 4-step method -->
            <div id="single-result-display" class="text-5xl font-extrabold text-green-700 bg-white px-8 py-4 rounded-full shadow-inner hidden">
                <span id="r1"></span>-<span id="r2"></span>-<span id="r3"></span>
            </div>

            <!-- This shows the range analysis for the Single/Two Cook Analysis -->
            <div id="possible-recipes-container" class="w-full text-center hidden">
                <p class="text-base font-bold text-gray-800 mb-3">
                    Total Difference (D) Required: <span id="required-difference" class="text-indigo-600"></span>
                </p>
                <div class="grid grid-cols-3 gap-4">
                    <div class="range-box">
                        <p class="text-sm font-semibold text-indigo-700 mb-1">R1 Range</p>
                        <p id="r1-range" class="text-2xl font-extrabold text-indigo-900">N/A</p>
                    </div>
                    <div class="range-box">
                        <p class="text-sm font-semibold text-indigo-700 mb-1">R2 Range</p>
                        <p id="r2-range" class="text-2xl font-extrabold text-indigo-900">N/A</p>
                    </div>
                    <div class="range-box">
                        <p class="text-sm font-semibold text-indigo-700 mb-1">R3 Range</p>
                        <p id="r3-range" class="text-2xl font-extrabold text-indigo-900">N/A</p>
                    </div>
                </div>
                
                <div id="unique-solution-message" class="mt-4 p-3 bg-red-100 text-red-800 border border-red-300 rounded-lg hidden">
                    <!-- Unique solution message appears here -->
                </div>

                <details class="mt-6 border border-gray-300 rounded-lg">
                    <summary class="p-3 bg-gray-100 font-medium cursor-pointer text-sm text-gray-700">
                        View All <span id="solution-count"></span> Possible Recipes (For Manual Checking)
                    </summary>
                    <div id="possible-recipes" class="p-3 grid grid-cols-3 gap-2 text-xs font-mono text-gray-700 bg-white">
                        <!-- List items injected here -->
                    </div>
                </details>
            </div>
            
            <!-- Brute Force Results -->
            <div id="brute-force-results" class="hidden">
                 <p class="text-xl font-bold text-gray-800 mb-4 text-center">Best Match Recipe Found (The 100% Recipe):</p>
                 <div id="best-match-recipe" class="text-5xl font-extrabold text-red-700 bg-white px-8 py-4 rounded-full shadow-inner mb-4">
                     <!-- Recipe injected here -->
                 </div>
                 <p class="text-lg font-semibold text-gray-700 mb-2">Check against your inputs:</p>
                 <div id="brute-force-table" class="space-y-2 text-left w-full">
                     <!-- Table rows injected here -->
                 </div>
            </div>
        </div>
        
        <div id="check-display" class="hidden mt-4 text-sm text-center p-3 rounded-lg bg-yellow-50 text-yellow-800">
            <!-- Consistency check warning appears here -->
        </div>
    </div>
</div>

<script>
    // Updated constants for the known input cooks (4 Step Method)
    const cooks = [
        { name: "Cook 1", inputs: [0, 0, 0] },
        { name: "Cook 2", inputs: [10, 0, 0] },
        { name: "Cook 3", inputs: [0, 10, 0] },
        { name: "Cook 4", inputs: [0, 0, 10] }
    ];

    /**
     * Calculates the required total difference (D) for a given percentage (P).
     * D = (100 - P) / 3
     * @param {number} p - The percentage output.
     * @returns {object | null} - The total difference object, or null if P is invalid.
     */
    function calculateDifference(p) {
        if (p < 10 || p > 100) {
            return null;
        }
        
        const remaining = 100 - p;
        const difference = remaining / 3;
        
        return {
            difference: difference,
            isInteger: (remaining % 3 === 0),
            expectedP: 100 - (Math.round(difference) * 3) // For warning message
        };
    }
    
    /**
     * Calculates the expected percentage for a given recipe (R) and test cook inputs (C).
     * P_expected = 100 - 3 * (|R1-C1| + |R2-C2| + |R3-C3|)
     * @param {number[]} recipe - [R1, R2, R3]
     * @param {number[]} cookInputs - [C1, C2, C3]
     * @returns {number} - The expected percentage.
     */
    function calculateExpectedPercentage(recipe, cookInputs) {
        const diff = Math.abs(recipe[0] - cookInputs[0]) + 
                     Math.abs(recipe[1] - cookInputs[1]) + 
                     Math.abs(recipe[2] - cookInputs[2]);
        return 100 - (3 * diff);
    }

    // --- Tab Management ---
    let currentTab = 'two-cook'; // Setting default tab to the Ultimate Solver (now Unlimited)

    function showTab(tabId) {
        currentTab = tabId;
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.add('hidden');
        });
        document.getElementById(tabId).classList.remove('hidden');

        document.querySelectorAll('.tab-button').forEach(btn => {
            btn.classList.remove('active');
            if (btn.getAttribute('data-tab') === tabId) {
                btn.classList.add('active');
            }
        });
        
        // Clear results when switching tabs
        clearResults();
    }
    
    function clearResults() {
        document.getElementById('message').textContent = '';
        document.getElementById('recipe-display').classList.add('hidden');
        document.getElementById('check-display').classList.add('hidden');
        document.getElementById('single-result-display').classList.add('hidden');
        document.getElementById('possible-recipes-container').classList.add('hidden');
        document.getElementById('brute-force-results').classList.add('hidden');
        document.getElementById('r1').textContent = '';
        document.getElementById('r2').textContent = '';
        document.getElementById('r3').textContent = '';
        document.getElementById('r1-range').textContent = 'N/A';
        document.getElementById('r2-range').textContent = 'N/A';
        document.getElementById('r3-range').textContent = 'N/A';
        document.getElementById('unique-solution-message').classList.add('hidden');
    }

    // --- Main Solver Function (Routes based on current tab) ---
    function solveRecipe(method) {
        clearResults();
        if (method === 'four-step') {
            solveFourStep();
        } else if (method === 'single-cook') {
            solveSingleCook();
        } else if (method === 'brute-force') {
            solveBruteForce();
        }
    }

    // --- 4 Step Method Logic (unchanged) ---
    function solveFourStep() {
        // Fetch values for the 4 Step Method
        const p1 = parseFloat(document.getElementById('p1').value);
        const p2 = parseFloat(document.getElementById('p2').value);
        const p3 = parseFloat(document.getElementById('p3').value);
        const p4 = parseFloat(document.getElementById('p4').value);

        const percentages = [p1, p2, p3, p4];
        const messageDiv = document.getElementById('message');
        
        // Basic Check
        if (percentages.some(p => isNaN(p) || p < 10 || p > 100)) {
            messageDiv.innerHTML = `<p class="text-red-600">Error: All percentages must be valid numbers between 10 and 100.</p>`;
            return;
        }

        let differences = [];
        let inconsistencyFound = false;
        let consistencyCheck = '';

        // 1. Calculate the required total difference (Di) for each cook
        for (let i = 0; i < 4; i++) {
            const result = calculateDifference(percentages[i]);
            
            differences.push(result.difference);
            
            if (!result.isInteger) {
                inconsistencyFound = true;
                const d = Math.round(result.difference);
                consistencyCheck += `The percentage for ${cooks[i].name} (${percentages[i]}%) is inconsistent with the 3% rule. The closest integer difference of ${d} digits would result in ${result.expectedP}% (vs. your ${percentages[i]}%).<br>`;
            }
        }

        const D1 = differences[0]; 
        const D2 = differences[1]; 
        const D3 = differences[2]; 
        const D4 = differences[3]; 

        // Solve the system of equations using the exact D values (including decimals)
        let R1 = (10 + D1 - D2) / 2;
        let R2 = (10 + D1 - D3) / 2;
        let R3 = D1 - R1 - R2;
        
        const isR1Int = Math.abs(R1 - Math.round(R1)) < 1e-9;
        const isR2Int = Math.abs(R2 - Math.round(R2)) < 1e-9;
        const isR3Int = Math.abs(R3 - Math.round(R3)) < 1e-9;
        
        R1 = Math.round(R1);
        R2 = Math.round(R2);
        R3 = Math.round(R3);

        if (!isR1Int || !isR2Int || !isR3Int || R1 < 0 || R1 > 10 || R2 < 0 || R2 > 10 || R3 < 0 || R3 > 10) {
            messageDiv.innerHTML = `<p class="text-red-600">Calculation Error: The inputs are too mathematically inconsistent to find a unique integer solution (0-10) using linear algebra. Use the **Unlimited Method** tab for anomaly data.</p>`;
            return;
        }

        // Final Consistency Check (using D4 - 0-0-10)
        const expectedD4 = Math.abs(cooks[3].inputs[0] - R1) + 
                           Math.abs(cooks[3].inputs[1] - R2) + 
                           Math.abs(cooks[3].inputs[2] - R3);
        
        if (Math.abs(expectedD4 - D4) > 1e-9) {
            inconsistencyFound = true;
            const expectedP4 = calculateExpectedPercentage([R1, R2, R3], cooks[3].inputs);
            consistencyCheck += `The calculated recipe (${R1}-${R2}-${R3}) results in ${expectedP4.toFixed(2)}% for Cook 4 (0-0-10), not ${percentages[3]}%.`;
        }

        // Display Result
        document.getElementById('r1').textContent = R1;
        document.getElementById('r2').textContent = R2;
        document.getElementById('r3').textContent = R3;
        
        document.getElementById('recipe-display-title').textContent = 'The Calculated Recipe is:';
        document.getElementById('recipe-display').classList.remove('hidden');
        document.getElementById('single-result-display').classList.remove('hidden');
        messageDiv.innerHTML = '<span class="text-green-600 font-bold">Success!</span> The recipe has been solved using the 4-step method.';

        if (inconsistencyFound) {
            document.getElementById('check-display').classList.remove('hidden');
            document.getElementById('check-display').innerHTML = `<strong>⚠️ Data Warning:</strong> The inputs provided were mathematically inconsistent (did not follow the exact 3% rule), but this is the only integer recipe (0-10) that fits the system of equations: <br> ${consistencyCheck}`;
        }
    }
    
    // --- Single Cook Analysis Logic (unchanged) ---
    function solveSingleCook() {
        const messageDiv = document.getElementById('message');
        const recipeDisplay = document.getElementById('recipe-display');
        const possibleRecipesContainer = document.getElementById('possible-recipes-container');
        const possibleRecipesDiv = document.getElementById('possible-recipes');
        const requiredDifferenceSpan = document.getElementById('required-difference');

        const c1 = parseInt(document.getElementById('a1').value);
        const c2 = parseInt(document.getElementById('a2').value);
        const c3 = parseInt(document.getElementById('a3').value);
        const P = parseInt(document.getElementById('pa').value);
        const C_inputs = [c1, c2, c3];

        if (C_inputs.some(val => isNaN(val) || val < 0 || val > 10) || isNaN(P) || P < 10 || P > 100) {
            messageDiv.innerHTML = `<p class="text-red-600">Error: All ingredient inputs must be integers between 0 and 10, and the percentage must be between 10 and 100.</p>`;
            return;
        }
        
        const result = calculateDifference(P);
        
        if (!result) {
            messageDiv.innerHTML = `<p class="text-red-600">Error: The percentage (${P}%) is outside the valid range (10% to 100%).</p>`;
            return;
        }

        const D = Math.round(result.difference); 
        
        if (!result.isInteger) {
            document.getElementById('check-display').classList.remove('hidden');
            document.getElementById('check-display').innerHTML = `<strong>⚠️ Data Warning:</strong> The percentage ${P}% is inconsistent with the 3% rule. A total difference of ${D} digits would result in ${result.expectedP}%. We will search for recipes matching a total difference of <strong>${D}</strong>.`;
        } else {
            document.getElementById('check-display').classList.add('hidden');
        }

        let possibleSolutions = [];
        let minR = [11, 11, 11]; 
        let maxR = [-1, -1, -1]; 
        
        for (let r1 = 0; r1 <= 10; r1++) {
            for (let r2 = 0; r2 <= 10; r2++) {
                for (let r3 = 0; r3 <= 10; r3++) {
                    
                    const D_R = Math.abs(r1 - c1) + Math.abs(r2 - c2) + Math.abs(r3 - c3);
                    
                    if (D_R === D) {
                        possibleSolutions.push({ r1, r2, r3, recipe: `${r1}-${r2}-${r3}` });
                        
                        minR[0] = Math.min(minR[0], r1);
                        maxR[0] = Math.max(maxR[0], r1);
                        minR[1] = Math.min(minR[1], r2);
                        maxR[1] = Math.max(maxR[1], r2);
                        minR[2] = Math.min(minR[2], r3);
                        maxR[2] = Math.max(maxR[2], r3);
                    }
                }
            }
        }

        possibleRecipesDiv.innerHTML = '';
        requiredDifferenceSpan.textContent = D; 

        if (possibleSolutions.length > 0) {
            document.getElementById('recipe-display-title').textContent = `Analysis Complete: ${possibleSolutions.length} Options`;
            document.getElementById('recipe-display').classList.remove('hidden');
            possibleRecipesContainer.classList.remove('hidden');
            messageDiv.innerHTML = '<span class="text-green-600 font-bold">Success!</span> Analytical ranges found.';

            document.getElementById('r1-range').textContent = `${minR[0]} - ${maxR[0]}`;
            document.getElementById('r2-range').textContent = `${minR[1]} - ${maxR[1]}`;
            document.getElementById('r3-range').textContent = `${minR[2]} - ${maxR[2]}`;
            document.getElementById('solution-count').textContent = possibleSolutions.length;

            possibleSolutions.forEach(solution => {
                const item = document.createElement('div');
                item.className = 'p-1 bg-white rounded shadow-sm hover:bg-gray-100 transition duration-100 text-center';
                item.textContent = solution.recipe;
                possibleRecipesDiv.appendChild(item);
            });
        } else {
            messageDiv.innerHTML = `<p class="text-red-600">Error: No valid recipe (0-10) found that matches the required difference of ${D}. Check your inputs.</p>`;
        }
    }


    // --- Unlimited Method (Brute Force) Logic - NOW WITH 10 OPTIONAL INPUTS ---
    function solveBruteForce() {
        const cookData = [];
        const messageDiv = document.getElementById('message');
        const bruteForceResultsDiv = document.getElementById('recipe-display');
        const bruteForceTable = document.getElementById('brute-force-table');
        document.getElementById('single-result-display').classList.add('hidden');
        document.getElementById('possible-recipes-container').classList.add('hidden');
        document.getElementById('brute-force-results').classList.remove('hidden');
        document.getElementById('recipe-display-title').textContent = 'Unlimited Method Result:';

        // List of all 10 potential cook inputs
        const cookInputSelectors = [
            // Mandatory/Expected base cooks (should be filled first)
            { c: ['bf_a1', 'bf_a2', 'bf_a3'], p: 'bf_pa', name: 'Cook 1 (0-0-0)' },
            { c: ['bf_b1', 'bf_b2', 'bf_b3'], p: 'bf_pb', name: 'Cook 2 (10-0-0)' },
            { c: ['bf_c1', 'bf_c2', 'bf_c3'], p: 'bf_pc', name: 'Cook 3 (0-10-0)' },
            { c: ['bf_d1', 'bf_d2', 'bf_d3'], p: 'bf_pd', name: 'Cook 4 (0-0-10)' },
            // Optional/User cooks
            { c: ['bf_e1', 'bf_e2', 'bf_e3'], p: 'bf_pe', name: 'Cook 5' },
            { c: ['bf_f1', 'bf_f2', 'bf_f3'], p: 'bf_pf', name: 'Cook 6' },
            { c: ['bf_g1', 'bf_g2', 'bf_g3'], p: 'bf_pg', name: 'Cook 7' },
            { c: ['bf_h1', 'bf_h2', 'bf_h3'], p: 'bf_ph', name: 'Cook 8' },
            { c: ['bf_i1', 'bf_i2', 'bf_i3'], p: 'bf_pi', name: 'Cook 9' },
            { c: ['bf_j1', 'bf_j2', 'bf_j3'], p: 'bf_pj', name: 'Cook 10' }
        ];

        let validCooksCount = 0;
        for (let i = 0; i < cookInputSelectors.length; i++) {
            const getVal = (id) => {
                const element = document.getElementById(id);
                // Use the value property, which is null/empty string for empty inputs
                return element ? element.value : '';
            };

            const R1_val = getVal(cookInputSelectors[i].c[0]);
            const R2_val = getVal(cookInputSelectors[i].c[1]);
            const R3_val = getVal(cookInputSelectors[i].c[2]);
            const P_val = getVal(cookInputSelectors[i].p);

            // Check if all fields for a cook are non-empty strings AND valid numbers
            if (R1_val !== '' && R2_val !== '' && R3_val !== '' && P_val !== '') {
                const R1 = parseInt(R1_val);
                const R2 = parseInt(R2_val);
                const R3 = parseInt(R3_val);
                const P = parseInt(P_val);

                // Final validation check for range
                if (!isNaN(R1) && R1 >= 0 && R1 <= 10 && 
                    !isNaN(R2) && R2 >= 0 && R2 <= 10 && 
                    !isNaN(R3) && R3 >= 0 && R3 <= 10 && 
                    !isNaN(P) && P >= 10 && P <= 100) {
                    
                    cookData.push({ 
                        inputs: [R1, R2, R3], 
                        targetP: P,
                        name: cookInputSelectors[i].name 
                    });
                    validCooksCount++;
                }
            }
        }
        
        if (validCooksCount < 2) {
            bruteForceResultsDiv.classList.add('hidden');
            messageDiv.innerHTML = `<p class="text-red-600">Error: You must provide complete data for at least two test cooks (R1-R2-R3 = %) where the percentage is 10% or higher.</p>`;
            return;
        }

        // --- Core Brute Force Algorithm ---
        let bestMatch = null;
        let lowestTotalError = Infinity;
        let potentialSolutions = []; 

        // Iterate through all 1331 possible recipes (0-0-0 to 10-10-10)
        for (let r1 = 0; r1 <= 10; r1++) {
            for (let r2 = 0; r2 <= 10; r2++) {
                for (let r3 = 0; r3 <= 10; r3++) {
                    const currentRecipe = [r1, r2, r3];
                    let currentTotalError = 0; 

                    for (const cook of cookData) {
                        const expectedP = calculateExpectedPercentage(currentRecipe, cook.inputs);
                        const error = Math.abs(expectedP - cook.targetP);
                        currentTotalError += error;
                    }

                    if (currentTotalError < lowestTotalError) {
                        lowestTotalError = currentTotalError;
                        potentialSolutions = [{ recipe: currentRecipe, error: currentTotalError }];
                    } else if (currentTotalError === lowestTotalError) {
                        potentialSolutions.push({ recipe: currentRecipe, error: currentTotalError });
                    }
                }
            }
        }
        
        // --- Display Results ---
        bestMatch = potentialSolutions[0];

        bruteForceResultsDiv.classList.remove('hidden');
        messageDiv.innerHTML = `<span class="text-green-600 font-bold">Unlimited Method Complete!</span> We analyzed ${validCooksCount} cooks and found ${potentialSolutions.length} recipe(s) with the minimum total error.`;
        
        // Display the best match recipe
        document.getElementById('best-match-recipe').innerHTML = `${bestMatch.recipe[0]}-${bestMatch.recipe[1]}-${bestMatch.recipe[2]}`;
        
        // Prepare the table showing how the best recipe fares against the inputs
        bruteForceTable.innerHTML = '';
        
        const header = `
            <div class="flex font-bold text-sm bg-gray-100 p-2 rounded-t-lg">
                <span class="w-1/3">Cook Input</span>
                <span class="w-1/4 text-center">Target %</span>
                <span class="w-1/4 text-center">Expected %</span>
                <span class="w-1/6 text-center">Error</span>
            </div>
        `;
        bruteForceTable.innerHTML += header;

        for (const cook of cookData) {
            const expectedP = calculateExpectedPercentage(bestMatch.recipe, cook.inputs);
            const error = Math.abs(expectedP - cook.targetP).toFixed(2);
            
            // Format name for display
            const cookNameDisplay = cook.name.includes('Cook') ? cook.name : `Cook (Custom)`;

            const row = `
                <div class="flex text-sm p-2 border-b border-gray-200">
                    <span class="w-1/3 text-gray-700">${cook.inputs[0]}-${cook.inputs[1]}-${cook.inputs[2]} (${cookNameDisplay})</span>
                    <span class="w-1/4 text-center font-bold text-red-600">${cook.targetP}%</span>
                    <span class="w-1/4 text-center font-bold text-green-600">${expectedP.toFixed(2)}%</span>
                    <span class="w-1/6 text-center text-red-700">${error}</span>
                </div>
            `;
            bruteForceTable.innerHTML += row;
        }

        const footer = `
            <div class="flex font-bold text-md p-2 bg-indigo-50 rounded-b-lg mt-2">
                <span class="w-3/4 text-right pr-4 text-indigo-800">TOTAL CUMULATIVE ERROR:</span>
                <span class="w-1/4 text-center text-indigo-900">${lowestTotalError.toFixed(2)}</span>
            </div>
        `;
        bruteForceTable.innerHTML += footer;
        
        // If multiple solutions exist, show a warning
        if (potentialSolutions.length > 1) {
            document.getElementById('check-display').classList.remove('hidden');
            document.getElementById('check-display').innerHTML = `<strong>⚠️ Multiple Solutions:</strong> ${potentialSolutions.length} different recipes were found that give the exact same minimum error. This means the inputs were not unique enough to determine the final recipe. Use the recipe above as the best guess, or try adding more unique test cooks!`;
        } else {
             document.getElementById('check-display').classList.add('hidden');
        }
    }


    // Set initial tab and run the initial solve
    window.onload = function() {
        showTab('two-cook');
        solveBruteForce(); 
    }
</script>
</body>
</html>